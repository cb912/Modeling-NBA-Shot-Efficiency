---
title: "Modeling Shot Efficiency in the NBA "
author: "Stat guys: Lewis Eatherton, Chris Yang, Charlie Bonetti"
date: "10/28/20"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE)

library(tidyverse)
library(knitr)
library(broom)
library(leaps)
shots <- read_csv("data/shot_logs.csv")
```

Your written report goes here! Before you submit, make sure your code chunks are turned off with `echo = FALSE` and there are no warnings or messages with `warning = FALSE` and `message = FALSE` 

### Introduction and EDA

For our STA 210 Final Project, our group is interested in investigating how certain variables may have an influence on a basketball players’ shot efficiency in the National Basketball Association (NBA). We are all avid NBA fans and express great curiosity in what makes a good shot versus a bat shot. Thus, we are excited by the opportunity to explore whether or not certain factors exist which surprisingly have an effect on shot success versus other factors that surprisingly don’t have an effect. An 2015 article titled “Basketball Shot Types and Shot Success in Different Levels of Competitive Basketball” published by Frane Erčulj and Erik Štrumbel piqued our interest in this subject matter. We became intrigued by how different shot types affected shot success across different levels of competition. Additionally, it was insightful to learn that there were no discernable differences between different situational variables on shot type and shot success between levels. Since the effect of situation variables on shot success seemed to be constant throughout all levels of competition, we wanted to see what exactly the situation variables might be, and to what degree of influence they had on an individual’s shot. As a result, we formulated our research question: “Do certain situational variables during a game have an effect on an NBA player’s shot success?” Based on our prior knowledge of the game of basketball, we recognize that both players and coaches deem certain shots as “good shots” and some as “bad”. Furthermore, through our own intuition after watching countless games and playing the sport ourselves, we hypothesize that some situational variables (e.g. shot distance or the distance of the closest defender) will have a greater effect on an NBA player’s shot success than other situational variables.


```{r}
### Data cleaning
shots <- shots %>%
  mutate(Make = case_when(
    SHOT_RESULT == "made" ~ 1,
    SHOT_RESULT == "missed" ~ 0))

shots <- shots %>%
  mutate(Make = as.factor(Make))
```


```{r}
##Checking conditions

### Linearity
library(Stat2Data)

emplogitplot1(Make ~ SHOT_CLOCK, data = shots, 
              ngroups = 5)

emplogitplot1(Make ~ CLOSE_DEF_DIST, data = shots, 
              ngroups = 10)

emplogitplot1(Make ~ SHOT_DIST, data = shots, 
              ngroups = 10)

emplogitplot1(Make ~ TOUCH_TIME, data = shots, 
              ngroups = 10)


shots %>%
  count(CLOSEST_DEFENDER, Make) %>%
  group_by(CLOSEST_DEFENDER) %>%
  mutate(prop = n/sum(n)) %>%
  filter(Make == "1") %>%
  mutate(emp_logit = log(prop/(1-prop)))


shots_players <- shots %>%
  filter(CLOSEST_DEFENDER == "Leonard, Kawhi"| CLOSEST_DEFENDER ==  "Curry, Stephen")

shots_players <- shots_players %>%
  filter(CLOSE_DEF_DIST < 5)

shots_players <- shots_players %>%
  mutate(Make = as.factor(Make))

shots_players <- shots_players %>%
  mutate(CLOSEST_DEFENDER = as.factor(CLOSEST_DEFENDER))

emplogitplot2(Make ~ CLOSE_DEF_DIST + CLOSEST_DEFENDER, data = shots_players)

```

Linearity is not totally satisfied... graphs aren't linear

independence and randomness seems fine accorind to how data was collected


we should also look into collinearity

### Creating Model
```{r}

full_mod <- glm(Make ~ SHOT_CLOCK + DRIBBLES + TOUCH_TIME + SHOT_DIST + CLOSE_DEF_DIST, data = shots, family = "binomial")

drop1(full_mod)



full_mod <- glm(Make ~ SHOT_CLOCK + DRIBBLES + TOUCH_TIME + SHOT_DIST + CLOSE_DEF_DIST + CLOSEST_DEFENDER, data = shots_players, family = "binomial")

drop1(full_mod)

current <- glm(Make ~ SHOT_CLOCK + TOUCH_TIME + SHOT_DIST + CLOSE_DEF_DIST + CLOSEST_DEFENDER, data = shots_players, family = "binomial")
drop1(current)

current <- glm(Make ~ SHOT_CLOCK + TOUCH_TIME + SHOT_DIST + CLOSE_DEF_DIST, data = shots_players, family = "binomial")
drop1(current)

current <- glm(Make ~ SHOT_CLOCK + SHOT_DIST + CLOSE_DEF_DIST, data = shots_players, family = "binomial")
drop1(current)


### testing for this interaction term

current_interaction <- glm(Make ~ SHOT_CLOCK + SHOT_DIST + CLOSE_DEF_DIST + CLOSE_DEF_DIST * CLOSEST_DEFENDER, data = shots_players, family = "binomial")

anova(current, current_interaction, test = "Chisq") %>%
  tidy()

current%>%
  tidy() %>%
  kable(digits = 3)


```

talk about final model outcome and how we came to it


###Discussion

Talk about our results, the limitations of these results, and what'd we do differently...
